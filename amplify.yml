version: 1
applications:
  - appRoot: apps/copilot
    frontend:
      phases:
        preBuild:
          commands:
            - npm install
        build:
          commands:
            # Add debug logging to verify values are present
            - "echo 'Checking AWS config values'"
            - "echo 'Region value $REGION'"
            - "echo 'VITE_AWS_ACCESS_KEY_ID=$ACCESS_KEY_ID' >> .env"
            - "echo 'VITE_AWS_SECRET_ACCESS_KEY=$SECRET_ACCESS_KEY' >> .env"
            - "echo 'VITE_AWS_KNOWLEDGE_BASE_ID=$KNOWLEDGE_BASE_ID' >> .env"
            - "echo 'VITE_AWS_REGION=$REGION' >> .env"
            - "cat .env | grep -v SECRET"  # Debug
            - "npm run build"
      artifacts:
        baseDirectory: dist
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**
