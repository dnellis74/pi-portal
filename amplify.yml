version: 1
applications:
  - appRoot: apps/copilot
    frontend:
      phases:
        preBuild:
          commands:
            - npm install
        build:
          commands:
            # Add debug logging to verify values are present
            - echo "Checking AWS config values..."
            - echo "Region: ${AWS_REGION}"
            - echo "Access Key starts with: ${secrets.AWS_ACCESS_KEY_ID:0:4}..."
            - echo "VITE_AWS_REGION=$AWS_REGION" >> .env
            - echo "VITE_AWS_ACCESS_KEY_ID=${secrets.AWS_ACCESS_KEY_ID}" >> .env
            - echo "VITE_AWS_SECRET_ACCESS_KEY='${secrets.AWS_SECRET_ACCESS_KEY}'" >> .env
            - cat .env | grep -v SECRET  # Debug: show non-secret env contents
            - npm run build
      artifacts:
        baseDirectory: dist
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**
